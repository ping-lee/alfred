{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/five-core-sql-statements/","result":{"data":{"site":{"siteMetadata":{"title":"知机县急流津","author":"lee-ping"}},"markdownRemark":{"id":"519a43f2-2238-5e61-99de-b7d666811869","html":"<h2 id=\"select\"><a href=\"#select\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>select</h2>\n<p>Select statements are used to extract data from one or more tables or other database objects. General select statements are like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> c<span class=\"token punctuation\">.</span>customer_id<span class=\"token punctuation\">,</span> \n       <span class=\"token function\">count</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>order_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> orders_ct\n<span class=\"token keyword\">from</span> oe<span class=\"token punctuation\">.</span>customers c\n<span class=\"token keyword\">join</span> oe<span class=\"token punctuation\">.</span>orders o\n<span class=\"token keyword\">on</span> c<span class=\"token punctuation\">.</span>customer_id <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span>customer_id\n<span class=\"token keyword\">where</span> c<span class=\"token punctuation\">.</span>gender <span class=\"token operator\">=</span> <span class=\"token string\">'F'</span>\n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> c<span class=\"token punctuation\">.</span>customer_id\n<span class=\"token keyword\">having</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">.</span>order_id<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">4</span>\n<span class=\"token keyword\">order</span> <span class=\"token keyword\">by</span> orders_ct<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>customer_id <span class=\"token punctuation\">;</span></code></pre></div>\n<p>The select list lists which columns need to be displayed in the final result set returned by the query. These columns can be the result of an actual column, an expression, <code class=\"language-text\">or even a select statement in the data table</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> c<span class=\"token punctuation\">.</span>customer_id<span class=\"token punctuation\">,</span>\n       c<span class=\"token punctuation\">.</span>cust_first_name<span class=\"token operator\">||</span><span class=\"token string\">' '</span><span class=\"token operator\">||</span>c<span class=\"token punctuation\">.</span>cust_last_name<span class=\"token punctuation\">,</span>\n       <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> e<span class=\"token punctuation\">.</span>last_name <span class=\"token keyword\">from</span> hr<span class=\"token punctuation\">.</span>employees e <span class=\"token keyword\">where</span> e<span class=\"token punctuation\">.</span>employee_id <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>account_mgr_id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> acct_mgr\n<span class=\"token keyword\">from</span> oe<span class=\"token punctuation\">.</span>customers c <span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"insert\"><a href=\"#insert\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>insert</h3>\n<p>Insert statements are used to add rows to a table, partition, or view.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> hr<span class=\"token punctuation\">.</span>jobs j <span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">.</span>job_id<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span>job_title<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span>min_salary<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">.</span>max_salary<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IT_PM'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Project Manager'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">rollback</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> scott<span class=\"token punctuation\">.</span>bonus <span class=\"token punctuation\">(</span>ename<span class=\"token punctuation\">,</span> job<span class=\"token punctuation\">,</span> sal<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> ename<span class=\"token punctuation\">,</span>\n       job<span class=\"token punctuation\">,</span> \n       sal <span class=\"token operator\">*</span> <span class=\"token number\">.10</span>\n<span class=\"token keyword\">from</span> scott<span class=\"token punctuation\">.</span>emp <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- 多表插入</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">all</span>\n<span class=\"token keyword\">when</span> sum_orders <span class=\"token operator\">&lt;</span> <span class=\"token number\">10000</span> <span class=\"token keyword\">then</span>\n<span class=\"token keyword\">into</span> small_customers\n<span class=\"token keyword\">when</span> sum_orders <span class=\"token operator\">>=</span> <span class=\"token number\">10000</span> <span class=\"token operator\">and</span> sum_orders <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span> <span class=\"token keyword\">then</span>\n<span class=\"token keyword\">into</span> medium_customers\n<span class=\"token keyword\">else</span>\n<span class=\"token keyword\">into</span> large_customers\n<span class=\"token keyword\">select</span> customer_id<span class=\"token punctuation\">,</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>order_total<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> sum_orders\n<span class=\"token keyword\">from</span> oe<span class=\"token punctuation\">.</span>orders\n<span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> customer_id <span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"update\"><a href=\"#update\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>update</h3>\n<p>The function of the update statement is to change the column value of the original row in the table. The syntax of this statement consists of three parts: update, set, and where. The update clause is used to specify the table to be updated, the set clause is used to indicate which columns have changed and adjusted values, and the where clause is used to filter the rows to be updated according to conditions.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Example 1: Update a single column value using an expression</span>\n<span class=\"token keyword\">update</span> employees2\n<span class=\"token keyword\">set</span> salary <span class=\"token operator\">=</span> salary <span class=\"token operator\">*</span> <span class=\"token number\">1.10</span> <span class=\"token comment\">-- increase salary by 10%</span>\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 2: Update a single column value using a subquery</span>\n<span class=\"token comment\">-- 可用于两表列数据同步</span>\n<span class=\"token keyword\">update</span> employees\n<span class=\"token keyword\">set</span> salary <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> employees2<span class=\"token punctuation\">.</span>salary\n                <span class=\"token keyword\">from</span> employees2\n                <span class=\"token keyword\">where</span> employees2<span class=\"token punctuation\">.</span>employee_id <span class=\"token operator\">=</span> employees<span class=\"token punctuation\">.</span>employee_id <span class=\"token comment\">-- 主键匹配</span>\n                <span class=\"token operator\">and</span> employees<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">!=</span> employees2<span class=\"token punctuation\">.</span>salary<span class=\"token punctuation\">)</span> <span class=\"token comment\">--相同的不更新</span>\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 3: Update single column using using subquery in WHERE clause to determine which rows to update</span>\n<span class=\"token keyword\">update</span> employees\n<span class=\"token keyword\">set</span> salary <span class=\"token operator\">=</span> salary <span class=\"token operator\">*</span> <span class=\"token number\">1.10</span>\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> department_id\n                          <span class=\"token keyword\">from</span> departments\n                          <span class=\"token keyword\">where</span> department_name <span class=\"token operator\">=</span> <span class=\"token string\">'EXecutive'</span><span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 4: Update a table using a SELECT statement to define the table and column values</span>\n<span class=\"token keyword\">update</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> e1<span class=\"token punctuation\">.</span>salary<span class=\"token punctuation\">,</span>\n               e2<span class=\"token punctuation\">.</span>salary <span class=\"token keyword\">as</span> new_sal<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">from</span> employees e1<span class=\"token punctuation\">,</span> employees2 e2\n        <span class=\"token keyword\">where</span> e1<span class=\"token punctuation\">.</span>employee_id <span class=\"token operator\">=</span> e2<span class=\"token punctuation\">.</span>employee_id\n          <span class=\"token operator\">and</span> e1<span class=\"token punctuation\">.</span>department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">set</span> salary <span class=\"token operator\">=</span> new_sal <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 5: Update multiple columns using a subquery</span>\n<span class=\"token keyword\">update</span> employees\n<span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span>salary<span class=\"token punctuation\">,</span> commission_pct<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> employees2<span class=\"token punctuation\">.</span>salary<span class=\"token punctuation\">,</span> <span class=\"token number\">.10</span> comm_pct\n                                  <span class=\"token keyword\">from</span> employees2\n                                  <span class=\"token keyword\">where</span> employees2<span class=\"token punctuation\">.</span>employee_id <span class=\"token operator\">=</span> employees<span class=\"token punctuation\">.</span>emloyee_id\n                                    <span class=\"token operator\">and</span> employees<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">!=</span> employees2<span class=\"token punctuation\">.</span>salary<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span> <span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- 比较Example 2、Example 4、Example 5。</span></code></pre></div>\n<h3 id=\"delete\"><a href=\"#delete\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>delete</h3>\n<p>The delete statement is used to remove data rows from the table.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Example 1: Delete rows from specified table using a filter condition in the WHERE clause</span>\n<span class=\"token keyword\">delete</span> <span class=\"token keyword\">from</span> employees2\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">rollback</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 2: Delete rows suing a subquery in the FROM clause</span>\n<span class=\"token keyword\">delete</span> <span class=\"token keyword\">from</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> employees2 <span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">rollback</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- Example 3: Delete rows from specified table using a subquery in the WHERE clause</span>\n<span class=\"token keyword\">delete</span> <span class=\"token keyword\">from</span> employees2\n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">in</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> department_id\n                          <span class=\"token keyword\">from</span> departments\n                          <span class=\"token keyword\">where</span> department_name <span class=\"token operator\">=</span> <span class=\"token string\">'Executive'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">rollback</span> <span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"merge\"><a href=\"#merge\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>merge</h3>\n<p>The merge statement can conditionally get the data rows to be updated or inserted into the table, and then update or insert rows into the table from one or more sources.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- 假设由两个表employees和dept60_bonuses，两表的数据如下</span>\n<span class=\"token keyword\">select</span> employee_id<span class=\"token punctuation\">,</span> last_name<span class=\"token punctuation\">,</span> salary \n<span class=\"token keyword\">from</span> employees \n<span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token punctuation\">;</span>\n\nEMPLOYEE_ID     LAST_NAME     SALARY\n<span class=\"token comment\">------------------------------------</span>\n<span class=\"token number\">103</span>             Hunold        <span class=\"token number\">9000</span>\n<span class=\"token number\">104</span>             Ernst         <span class=\"token number\">6000</span>\n<span class=\"token number\">105</span>             Austin        <span class=\"token number\">4800</span>\n<span class=\"token number\">106</span>             Pataballa     <span class=\"token number\">4800</span>\n<span class=\"token number\">107</span>             Lorentz       <span class=\"token number\">4200</span>\n\n<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> dept60_bonuses <span class=\"token punctuation\">;</span>\n\nEMPLOYEE_ID     BONUS_AMT\n<span class=\"token comment\">-------------------------</span>\n<span class=\"token number\">103</span>             <span class=\"token number\">0</span>\n<span class=\"token number\">104</span>             <span class=\"token number\">100</span>\n<span class=\"token number\">105</span>             <span class=\"token number\">0</span>\n\n\n<span class=\"token keyword\">merge</span> <span class=\"token keyword\">into</span> dept60_bonuses b\n<span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">select</span> employee_id<span class=\"token punctuation\">,</span> salary<span class=\"token punctuation\">,</span> department_id\n        <span class=\"token keyword\">from</span> employees\n        <span class=\"token keyword\">where</span> department_id <span class=\"token operator\">=</span> <span class=\"token number\">60</span>\n      <span class=\"token punctuation\">)</span> e\n<span class=\"token keyword\">on</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">.</span>employee_id <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>employee_id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">when</span> <span class=\"token keyword\">matched</span> <span class=\"token keyword\">then</span>\n  <span class=\"token keyword\">update</span> <span class=\"token keyword\">set</span> b<span class=\"token punctuation\">.</span>bonus_amt <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">*</span> <span class=\"token number\">0.2</span>\n  <span class=\"token keyword\">where</span> b<span class=\"token punctuation\">.</span>bonus_amt <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">delete</span> <span class=\"token keyword\">where</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">></span> <span class=\"token number\">7500</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">when</span> <span class=\"token operator\">not</span> <span class=\"token keyword\">matched</span> <span class=\"token keyword\">then</span>\n  <span class=\"token keyword\">insert</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">.</span>employee_id<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">.</span>bonus_amt<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>employee_id<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">*</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">where</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>salary <span class=\"token operator\">&lt;</span> <span class=\"token number\">7500</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> dept60_bonuses <span class=\"token punctuation\">;</span>\n\nEMPLOYEE_ID     BONUS_AMT\n<span class=\"token comment\">-------------------------</span>\n<span class=\"token number\">104</span>             <span class=\"token number\">100</span>\n<span class=\"token number\">105</span>             <span class=\"token number\">960</span>\n<span class=\"token number\">106</span>             <span class=\"token number\">480</span>\n<span class=\"token number\">107</span>             <span class=\"token number\">420</span></code></pre></div>","timeToRead":3,"frontmatter":{"title":"5个核心sql语句","date":"January 11, 2020","spoiler":"database","cta":"plsql"},"fields":{"slug":"/en/five-core-sql-statements/","langKey":"en"}}},"pageContext":{"slug":"/en/five-core-sql-statements/","translations":["en"],"translatedLinks":[]}}}